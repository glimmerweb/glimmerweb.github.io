<!DOCTYPE html>
<html lang="en">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: 'Roboto', sans-serif;
    }

    #main-container {
      flex-grow: 1;
      display: flex;
    }

    #canvas {
      flex-grow: 1;
      border: 2px dashed #ccc;
      background-color: #ffffff;
      padding: 20px;
      position: relative;
      overflow: auto;
      background-image: linear-gradient(to right, #eee 1px, transparent 1px),
        linear-gradient(to bottom, #eee 1px, transparent 1px);
      background-size: 20px 20px;
    }

    #footer {
      height: 150px;
      background-color: #f4f4f4;
      padding: 20px;
      display: flex;
      border: 2px solid #ff7e5f;
    }

    #sidebar {
      width: 30%;
      padding: 20px;
      overflow-y: auto;
    }

    #code-output {
      width: 70%;
      background-color: #f1f1f1;
      padding: 20px;
      overflow-y: scroll;
      border: 2px solid #ff7e5f;
      margin-right: 15px;
    }

    .draggable-element {
      border: 2px solid #ff7e5f;
      padding: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      text-align: center;
    }

    .selected-element {
      outline: 2px solid #ff7e5f;
      position: relative;
    }

    .resizable {
      position: relative;
      display: inline-block;
    }

    .resizable .resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ff7e5f;
      border-radius: 50%;
      cursor: nwse-resize;
    }

    .resize-handle.tl {
      top: -5px;
      left: -5px;
    }

.custom-button {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    font-size: 1.1em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #fff;
    background: linear-gradient(to right, #ff7e5f, #feb47b);
    border: 2px solid #ff7e5f;
    text-align: center;
    cursor: pointer;
    transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    outline: none;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

    .resize-handle.tr {
      top: -5px;
      right: -5px;
    }

    .resize-handle.br {
      bottom: -5px;
      right: -5px;
    }

    .resize-handle.bl {
      bottom: -5px;
      left: -5px;
    }

    .controls {
      margin-top: 20px;
    }

    .controls input,
    .controls select {
      width: 100%;
      margin-bottom: 10px;
    }

    

    #css-popup {
      display: none;
      position: absolute;
      top: 50px;
      left: 61%;
      width: 300px;
      background-color: white;
      border: 1px solid #ddd;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 10;
      cursor: move;
      transform: scale(0.7);
    }

    #css-popup input,
    #css-popup select {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }

    #css-popup button {
      margin-top: 10px;
    }

    #popup-header {
      background-color: #ff7e5f;
      color: white;
      padding: 10px;
      cursor: move;
      text-align: center;
      font-weight: bold;
    }

    #buttons-container {
      display: flex;
      gap: 10px;
    }

    .undo-button {
      padding: 10px 20px;
      border: 1px solid #ddd;
      background-color: #007bff;
      color: white;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
    }

    .undo-button:hover {
      background-color: #0056b3;
    }

    #disappearingText {
      opacity: 0;
      transition: opacity 1.4s ease-in-out;
      text-align: right;
      font-weight: bold;
      background-color: #f4f4f4;
      font-size: 0.3em;
    }
    
    .custom-button:hover,
.custom-button:focus {
    background: linear-gradient(to right, #feb47b, #ff7e5f);
    color: #05060f;
    border-color: #feb47b;
}

.custom-button:active {
    background: #ff7e5f;
    color: #fff;
    border-color: #ff7e5f;
}
  </style>
</head>

<body>
  <div id="main-container">

    <div id="canvas"></div>

  </div>
  
  <div id="footer">

    <div id="sidebar">
      <h2>Elements</h2>
<div class="draggable-element" draggable="true" data-type="text">Text</div>
<div class="draggable-element" draggable="true" data-type="button">Button</div>
<div class="draggable-element" draggable="true" data-type="image">Image</div>
<div class="draggable-element" draggable="true" data-type="form">Form</div>
<div class="draggable-element" draggable="true" data-type="video">Video</div>
<div class="draggable-element" draggable="true" data-type="contact-form">Contact Form</div>
<div class="draggable-element" draggable="true" data-type="input">Input Field</div>
<div class="draggable-element" draggable="true" data-type="heading">Heading</div>
<div class="draggable-element" draggable="true" data-type="paragraph">Paragraph</div>
<div class="draggable-element" draggable="true" data-type="list">List</div>
<div class="draggable-element" draggable="true" data-type="table">Table</div>
<div class="draggable-element" draggable="true" data-type="icon">Icon</div>


      <div id="custom-controls" class="controls">
      </div>

      <h3>Additional Options</h3>
      <button id="open-popup" class="custom-button">Custom CSS</button>
      <br><br>
      <button id="add-js" class="custom-button">Custom JS</button>
<br><br>
      <center><a href="https://glimmerweb.github.io/docs/">
  <button class="custom-button">Docs</button>
</a></center>
    </div>

    <div id="code-output">
      <h2>Code</h2>
      <pre id="code-preview"></pre>
      <button id="download-code" class="custom-button">Download Code</button>
    </div>

    <div id="buttons-container">
      <div id="undo-button" class="button">⤶</div>
      <div id="redo-button" class="button">⤷</div>
    </div>
    
  </div>
  <div id="disappearingText"></div>

  <div id="css-popup" style="display: none; /* Ensure it's hidden by default */">
  <div id="popup-header">CSS Editor</div>

  <label for="bg-type">Background Type:</label>
  <select id="bg-type">
    <option value="solid">Solid Color</option>
    <option value="gradient">Gradient</option>
  </select>

  <div id="solid-bg">
    <label for="bg-color">Background Color:</label>
    <input type="color" id="bg-color" placeholder="e.g., #3498db">
  </div>
  
  <div id="gradient-bg" style="display: none;">
    <label for="bg-gradient">Background Gradient:</label>
    <input type="text" id="bg-gradient" placeholder="e.g., linear-gradient(to right, #ff7e5f, #feb47b)">
  </div>

  <label for="color">Text Color:</label>
  <input type="color" id="color" placeholder="e.g., #ffffff">

  <label for="font-size">Font Size:</label>
  <select id="font-size">
    <option value="">Select font size</option>
    <option value="12px">12px</option>
    <option value="14px">14px</option>
    <option value="16px">16px</option>
    <option value="18px">18px</option>
    <option value="20px">20px</option>
  </select>

  <label for="margin">Margin:</label>
  <input type="text" id="margin" placeholder="e.g., 10px">

  <label for="padding">Padding:</label>
  <input type="text" id="padding" placeholder="e.g., 10px">

  <label for="border">Border:</label>
  <input type="text" id="border" placeholder="e.g., 1px solid #2980b9">

  <label for="width">Width:</label>
  <input type="text" id="width" placeholder="e.g., 50px">

  <label for="height">Height:</label>
  <input type="text" id="height" placeholder="e.g., 50px">

  <label for="z-index">Z-Index:</label>
  <input type="number" id="z-index" placeholder="e.g., 1">

  <label for="custom-css">Written CSS:</label><br>
  <textarea id="custom-css" rows="4" placeholder="Enter custom CSS here..."></textarea><br>

  <button id="apply-css">Apply CSS</button>
  or
  <button id="apply-custom-css">Apply Written CSS</button>
  <button id="close-popup">Close</button>
</div>


  <script>
    let undoStack = [];
    let redoStack = [];
    const MAX_STACK_SIZE = 100;

function handleStateChange() {
  const state = captureState();

  if (undoStack.length >= MAX_STACK_SIZE) {
    undoStack.shift(); 
  }
  undoStack.push(state);

  redoStack = [];

  console.log('State captured and pushed to undoStack:', state);
  console.log('Current undoStack size:', undoStack.length);
  console.log('redoStack cleared');
}

    let selectedElement = null;
    const canvas = document.getElementById('canvas');
    const codePreview = document.getElementById('code-preview');
    const GRID_SIZE = 20; // Grid size in pixels
    function snapToGrid(value) {
      return Math.round(value / GRID_SIZE) * GRID_SIZE;
    }

    function createElement(type, placeholders = {}) {
      let newElement;
      switch (type) {
        case 'text':
          newElement = document.createElement('p');
          newElement.textContent = 'New Text';
          break;
        case 'button':
          newElement = document.createElement('button');
          newElement.textContent = 'New Button';
          break;
        case 'image':
          newElement = document.createElement('img');
          newElement.src = 'https://via.placeholder.com/150';
          break;
        case 'form':
          newElement = document.createElement('form');
          newElement.innerHTML = `
        <input type="text" placeholder="${placeholders.name || 'Placeholder'}">
        <input type="email" placeholder="${placeholders.email || 'Placeholder'}">
        <button type="submit">Submit</button>
      `;
          break;
        case 'text-placeholder':
          selectedElement.querySelector('input[type="text"]').placeholder = value;
          break;
        case 'email-placeholder':
          selectedElement.querySelector('input[type="email"]').placeholder = value;
          break;
        case 'carousel':
          newElement = document.createElement('div');
          newElement.className = 'carousel';
          newElement.innerHTML = `
        <div class="carousel-slide">Slide 1</div>
        <div class="carousel-slide">Slide 2</div>
        <div class="carousel-slide">Slide 3</div>
      `;
          break;
        case 'video':
          newElement = document.createElement('video');
          newElement.controls = true;
          newElement.src = 'https://www.w3schools.com/html/mov_bbb.mp4';
          break;
        case 'contact-form':
          newElement = document.createElement('form');
          newElement.className = 'contact-form';
          newElement.innerHTML = `
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" placeholder="${placeholders.name || ''}">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="${placeholders.email || ''}">
        <label for="message">Message:</label>
        <textarea id="message" name="message" placeholder="${placeholders.message || ''}"></textarea>
        <button type="submit">Send</button>
      `;
          break;
case 'input':
      newElement = document.createElement('input');
      newElement.type = 'text';
      newElement.placeholder = 'Enter text here';
      break;
    case 'heading':
      newElement = document.createElement('h2');
      newElement.textContent = 'New Heading';
      break;
    case 'paragraph':
      newElement = document.createElement('p');
      newElement.textContent = 'This is a new paragraph. Double-click to edit.';
      break;
    case 'social-media':
      newElement = document.createElement('div');
      newElement.innerHTML = '<a href="#" class="fa fa-facebook"></a> <a href="#" class="fa fa-twitter"></a> <a href="#" class="fa fa-instagram"></a>';
      newElement.setAttribute('data-platforms', 'facebook,twitter,instagram');
      break;
    case 'icon':
      newElement = document.createElement('i');
      newElement.className = 'fas fa-star';
      break;
    case 'divider':
      newElement = document.createElement('hr');
      break;
    case 'table':
      newElement = document.createElement('table');
      newElement.innerHTML = '<tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Row 1, Cell 1</td><td>Row 1, Cell 2</td></tr>';
      newElement.setAttribute('data-rows', '2');
      newElement.setAttribute('data-columns', '2');
      break;
    case 'list':
      newElement = document.createElement('ul');
      newElement.innerHTML = '<li>Item 1</li><li>Item 2</li><li>Item 3</li>';
      break;
    case 'table-of-contents':
      newElement = document.createElement('div');
      newElement.innerHTML = '<h3>Table of Contents</h3><ul><li><a href="#section1">Section 1</a></li><li><a href="#section2">Section 2</a></li></ul>';
      newElement.setAttribute('data-depth', '1');
      break;
  }
  
newElement.style.position = 'absolute';
  newElement.classList.add('draggable');
  newElement.classList.add('resizable');
  addResizeHandles(newElement);
  return newElement;
}

function addResizeHandles(element) {
  const handles = ['tl', 'tr', 'br', 'bl'];
  handles.forEach(handle => {
    const div = document.createElement('div');
    div.className = `resize-handle ${handle}`;
    element.appendChild(div);
    div.addEventListener('mousedown', event => initResize(event, element));
  });
}

function initResize(event, element) {
  event.preventDefault();
  event.stopPropagation();
  const handle = event.target.className.split(' ')[1];
  const startX = event.clientX;
  const startY = event.clientY;
  const startWidth = parseInt(getComputedStyle(element).width);
  const startHeight = parseInt(getComputedStyle(element).height);
  const startLeft = parseInt(element.style.left);
  const startTop = parseInt(element.style.top);

  function resizeMove(moveEvent) {
    let newWidth = startWidth;
    let newHeight = startHeight;
    let newLeft = startLeft;
    let newTop = startTop;
    if (handle.includes('r')) {
      newWidth = snapToGrid(startWidth + moveEvent.clientX - startX);
    } else if (handle.includes('l')) {
      const dx = snapToGrid(moveEvent.clientX - startX);
      newWidth = startWidth - dx;
      newLeft = startLeft + dx;
    }
    if (handle.includes('b')) {
      newHeight = snapToGrid(startHeight + moveEvent.clientY - startY);
    } else if (handle.includes('t')) {
      const dy = snapToGrid(moveEvent.clientY - startY);
      newHeight = startHeight - dy;
      newTop = startTop + dy;
    }
    element.style.width = `${newWidth}px`;
    element.style.height = `${newHeight}px`;
    element.style.left = `${newLeft}px`;
    element.style.top = `${newTop}px`;
  }

  function resizeEnd() {
    document.removeEventListener('mousemove', resizeMove);
    document.removeEventListener('mouseup', resizeEnd);
    handleStateChange();
    updateCode();
  }
  document.addEventListener('mousemove', resizeMove);
  document.addEventListener('mouseup', resizeEnd);
}

    function startDrag(event) {
      const target = event.target.closest('.draggable');
      if (!target) return;
      event.preventDefault();
      selectElement(target);
      const startX = event.clientX;
      const startY = event.clientY;
      const startLeft = parseInt(target.style.left) || 0;
      const startTop = parseInt(target.style.top) || 0;

      function dragMove(moveEvent) {
        const dx = moveEvent.clientX - startX;
        const dy = moveEvent.clientY - startY;
        const newLeft = snapToGrid(startLeft + dx);
        const newTop = snapToGrid(startTop + dy);
        target.style.left = `${newLeft}px`;
        target.style.top = `${newTop}px`;
      }

      function dragEnd() {
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        updateCode();
      }
      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', dragEnd);
    }

    function addResizeHandles(element) {
      const handles = ['tl', 'tr', 'br', 'bl'];
      handles.forEach(handle => {
        const div = document.createElement('div');
        div.className = `resize-handle ${handle}`;
        element.appendChild(div);
        div.addEventListener('mousedown', event => initResize(event, element));
      });
    }

    function initResize(event, element) {
      event.preventDefault();
      event.stopPropagation();
      const handle = event.target.className.split(' ')[1];
      const startX = event.clientX;
      const startY = event.clientY;
      const startWidth = parseInt(getComputedStyle(element).width);
      const startHeight = parseInt(getComputedStyle(element).height);
      const startLeft = parseInt(element.style.left);
      const startTop = parseInt(element.style.top);

      function resizeMove(moveEvent) {
        let newWidth = startWidth;
        let newHeight = startHeight;
        let newLeft = startLeft;
        let newTop = startTop;
        if (handle.includes('r')) {
          newWidth = snapToGrid(startWidth + moveEvent.clientX - startX);
        } else if (handle.includes('l')) {
          const dx = snapToGrid(moveEvent.clientX - startX);
          newWidth = startWidth - dx;
          newLeft = startLeft + dx;
        }
        if (handle.includes('b')) {
          newHeight = snapToGrid(startHeight + moveEvent.clientY - startY);
        } else if (handle.includes('t')) {
          const dy = snapToGrid(moveEvent.clientY - startY);
          newHeight = startHeight - dy;
          newTop = startTop + dy;
        }
        element.style.width = `${newWidth}px`;
        element.style.height = `${newHeight}px`;
        element.style.left = `${newLeft}px`;
        element.style.top = `${newTop}px`;
      }

      function resizeEnd() {
        document.removeEventListener('mousemove', resizeMove);
        document.removeEventListener('mouseup', resizeEnd);
        updateCode();
      }
      document.addEventListener('mousemove', resizeMove);
      document.addEventListener('mouseup', resizeEnd);
    }

    function selectElement(element) {
      if (selectedElement) {
        selectedElement.classList.remove('selected-element');
      }
      selectedElement = element;
      selectedElement.classList.add('selected-element');
      updateControls();
    }

    function updateControls() {
      const controlsDiv = document.getElementById('custom-controls');
      controlsDiv.innerHTML = '';
      if (!selectedElement) return;
      const elementType = selectedElement.tagName.toLowerCase();
      switch (elementType) {
        case 'p':
          controlsDiv.innerHTML = `
    <label for="text-content">Text Content</label>
    <input type="text" id="text-content" value="${selectedElement.textContent}">
    <label for="text-font">Font Family</label>
    <select id="text-font">
        <!-- Add more font options here -->
    </select>
    <label for="text-size">Font Size (px)</label>
    <input type="number" id="text-size" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
    <label for="text-color">Text Color</label>
    <input type="color" id="text-color" value="${getComputedStyle(selectedElement).color}">
    <label for="text-align">Text Align</label>
    <select id="text-align">
        <option value="left" ${getComputedStyle(selectedElement).textAlign === 'left'?'selected' : ''}>Left</option>
        <option value="center" ${getComputedStyle(selectedElement).textAlign === 'center'?'selected' : ''}>Center</option>
        <option value="right" ${getComputedStyle(selectedElement).textAlign === 'right'?'selected' : ''}>Right</option>
    </select>
    <label for="line-height">Line Height</label>
    <input type="number" id="line-height" value="${parseFloat(getComputedStyle(selectedElement).lineHeight)}" step="0.1">
    <label for="letter-spacing">Letter Spacing (px)</label>
    <input type="number" id="letter-spacing" value="${parseFloat(getComputedStyle(selectedElement).letterSpacing)}" step="0.1">
    <label for="font-weight">Font Weight</label>
    <select id="font-weight">
        <option value="normal" ${getComputedStyle(selectedElement).fontWeight === 'normal'?'selected' : ''}>Normal</option>
        <option value="bold" ${getComputedStyle(selectedElement).fontWeight === 'bold'?'selected' : ''}>Bold</option>
    </select>
    <label for="font-style">Font Style</label>
    <select id="font-style">
        <option value="normal" ${getComputedStyle(selectedElement).fontStyle === 'normal'?'selected' : ''}>Normal</option>
        <option value="italic" ${getComputedStyle(selectedElement).fontStyle === 'italic'?'selected' : ''}>Italic</option>
    </select>
`;
          break;
        case 'button':
          controlsDiv.innerHTML = `
    <label for="button-text">Button Text</label>
    <input type="text" id="button-text" value="${selectedElement.textContent}">
    <label for="button-bg">Background Color</label>
    <input type="color" id="button-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
    <label for="button-color">Text Color</label>
    <input type="color" id="button-color" value="${getComputedStyle(selectedElement).color}">
    <label for="button-border">Border (px)</label>
    <input type="number" id="button-border" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
    <label for="button-radius">Border Radius (px)</label>
    <input type="number" id="button-radius" value="${parseInt(getComputedStyle(selectedElement).borderRadius)}">
    <label for="button-font-size">Font Size (px)</label>
    <input type="number" id="button-font-size" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
    <label for="button-font-weight">Font Weight</label>
    <select id="button-font-weight">
        <option value="normal" ${getComputedStyle(selectedElement).fontWeight === 'normal'?'selected' : ''}>Normal</option>
        <option value="bold" ${getComputedStyle(selectedElement).fontWeight === 'bold'?'selected' : ''}>Bold</option>
    </select>
    <label for="button-letter-spacing">Letter Spacing (px)</label>
    <input type="number" id="button-letter-spacing" value="${parseFloat(getComputedStyle(selectedElement).letterSpacing)}" step="0.1">
    <label for="button-padding">Padding (px)</label>
    <input type="number" id="button-padding" value="${parseInt(getComputedStyle(selectedElement).padding)}">
`;
          break;
        case 'img':
          controlsDiv.innerHTML = `
    <label for="image-src">Image Source</label>
    <input type="text" id="image-src" value="${selectedElement.src}">
    <label for="image-width">Width (px)</label>
    <input type="number" id="image-width" value="${parseInt(selectedElement.width)}">
    <label for="image-height">Height (px)</label>
    <input type="number" id="image-height" value="${parseInt(selectedElement.height)}">
    <label for="image-alt">Alt Text</label>
    <input type="text" id="image-alt" value="${selectedElement.alt}">
    <label for="image-border">Border (px)</label>
    <input type="number" id="image-border" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
    <label for="image-radius">Border Radius (px)</label>
    <input type="number" id="image-radius" value="${parseInt(getComputedStyle(selectedElement).borderRadius)}">
    <label for="image-fit">Object Fit</label>
    <select id="image-fit">
        <option value="fill" ${getComputedStyle(selectedElement).objectFit === 'fill'?'selected' : ''}>Fill</option>
        <option value="contain" ${getComputedStyle(selectedElement).objectFit === 'contain'?'selected' : ''}>Contain</option>
        <option value="cover" ${getComputedStyle(selectedElement).objectFit === 'cover'?'selected' : ''}>Cover</option>
    </select>
`;
          break;
        case 'form':
          controlsDiv.innerHTML = `
        <label for="form-action">Form Action URL</label>
        <input type="text" id="form-action" placeholder="Enter form action URL" value="${selectedElement.action || ''}">
        <label for="form-method">Method</label>
        <select id="form-method">
            <option value="get" ${selectedElement.method === 'get'?'selected' : ''}>GET</option>
            <option value="post" ${selectedElement.method === 'post'?'selected' : ''}>POST</option>
        </select>
        <label for="form-bg">Background Color</label>
        <input type="color" id="form-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
        <label for="form-padding">Padding (px)</label>
        <input type="number" id="form-padding" placeholder="Enter padding in px" value="${parseInt(getComputedStyle(selectedElement).padding)}">
        <label for="form-margin">Margin (px)</label>
        <input type="number" id="form-margin" placeholder="Enter margin in px" value="${parseInt(getComputedStyle(selectedElement).margin)}">
        <label for="text-placeholder">Text Input Placeholder</label>
        <input type="text" id="text-placeholder" placeholder="Enter text input placeholder" value="${selectedElement.querySelector('input[type="text"]').placeholder}">
        <label for="email-placeholder">Email Input Placeholder</label>
        <input type="text" id="email-placeholder" placeholder="Enter email input placeholder" value="${selectedElement.querySelector('input[type="email"]').placeholder}">
        <label for="contact-form-text-placeholder">Contact Form Text Placeholder</label>
        <input type="text" id="contact-form-text-placeholder" placeholder="Enter contact form text placeholder" value="${selectedElement.querySelector('textarea').placeholder}">
      `;
          break;
        case 'carousel':
          controlsDiv.innerHTML = `
    <label for="carousel-width">Width (px)</label>
    <input type="number" id="carousel-width" value="${selectedElement.offsetWidth}">
    <label for="carousel-height">Height (px)</label>
    <input type="number" id="carousel-height" value="${selectedElement.offsetHeight}">
    <label for="carousel-autoplay">Autoplay</label>
    <input type="checkbox" id="carousel-autoplay" ${selectedElement.hasAttribute('data-autoplay') ? 'checked' : ''}>
    <label for="carousel-speed">Transition Speed (ms)</label>
    <input type="number" id="carousel-speed" value="${selectedElement.getAttribute('data-speed') || 500}">
    <label for="carousel-slides">Number of Slides</label>
    <input type="number" id="carousel-slides" value="${selectedElement.getAttribute('data-slides') || 1}">
`;
          break;
        case 'video':
          controlsDiv.innerHTML = `
    <label for="video-src">Video Source</label>
    <input type="text" id="video-src" value="${selectedElement.src}">
    <label for="video-width">Width (px)</label>
    <input type="number" id="video-width" value="${parseInt(selectedElement.width)}">
    <label for="video-height">Height (px)</label>
    <input type="number" id="video-height" value="${parseInt(selectedElement.height)}">
    <label for="video-controls">Show Controls</label>
    <input type="checkbox" id="video-controls" ${selectedElement.controls ? 'checked' : ''}>
    <label for="video-autoplay">Autoplay</label>
    <input type="checkbox" id="video-autoplay" ${selectedElement.autoplay ? 'checked' : ''}>
    <label for="video-loop">Loop</label>
    <input type="checkbox" id="video-loop" ${selectedElement.loop ? 'checked' : ''}>
    <label for="video-volume">Volume</label>
    <input type="range" id="video-volume" min="0" max="1" step="0.1" value="${selectedElement.volume}">
`;
          break;
        case 'contact-form':
          controlsDiv.innerHTML = `
        <label for="contact-form-action">Form Action URL</label>
        <input type="text" id="contact-form-action" value="${selectedElement.action || ''}">
        <label for="contact-form-method">Method</label>
        <select id="contact-form-method">
            <option value="get" ${selectedElement.method === 'get'?'selected' : ''}>GET</option>
            <option value="post" ${selectedElement.method === 'post'?'selected' : ''}>POST</option>
        </select>
        <label for="contact-form-bg">Background Color</label>
        <input type="color" id="contact-form-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
        <label for="contact-form-padding">Padding (px)</label>
        <input type="number" id="contact-form-padding" value="${parseInt(getComputedStyle(selectedElement).padding)}">
        <label for="contact-form-margin">Margin (px)</label>
        <input type="number" id="contact-form-margin" value="${parseInt(getComputedStyle(selectedElement).margin)}">
    `;
          break;
case 'input':
      controlsDiv.innerHTML = `
        <label for="input-type">Input Type</label>
        <select id="input-type">
          <option value="text" ${selectedElement.type === 'text' ? 'selected' : ''}>Text</option>
          <option value="number" ${selectedElement.type === 'number' ? 'selected' : ''}>Number</option>
          <option value="email" ${selectedElement.type === 'email' ? 'selected' : ''}>Email</option>
          <option value="password" ${selectedElement.type === 'password' ? 'selected' : ''}>Password</option>
        </select>
        <label for="input-placeholder">Placeholder</label>
        <input type="text" id="input-placeholder" value="${selectedElement.placeholder}">
        <label for="input-required">Required</label>
        <input type="checkbox" id="input-required" ${selectedElement.required ? 'checked' : ''}>
      `;
      break;
    case 'h2':
      controlsDiv.innerHTML = `
        <label for="heading-text">Heading Text</label>
        <input type="text" id="heading-text" value="${selectedElement.textContent}">
        <label for="heading-size">Heading Size</label>
        <select id="heading-size">
          <option value="h1">H1</option>
          <option value="h2" selected>H2</option>
          <option value="h3">H3</option>
          <option value="h4">H4</option>
        </select>
      `;
      break;
          case 'div':
      if (selectedElement.querySelector('.fa')) {
        const platforms = selectedElement.getAttribute('data-platforms').split(',');
        controlsDiv.innerHTML = `
          <h3>Social Media Platforms</h3>
          <div id="platform-checkboxes">
            ${['facebook', 'twitter', 'instagram', 'linkedin', 'youtube'].map(platform => `
              <label>
                <input type="checkbox" id="${platform}-checkbox" ${platforms.includes(platform) ? 'checked' : ''}>
                ${platform.charAt(0).toUpperCase() + platform.slice(1)}
              </label>
            `).join('')}
          </div>
        `;
      } else if (selectedElement.querySelector('ul')) {
        controlsDiv.innerHTML = `
          <label for="toc-depth">Depth</label>
          <input type="number" id="toc-depth" min="1" max="6" value="${selectedElement.getAttribute('data-depth')}">
          <button id="update-toc">Update TOC</button>
        `;
      }
      break;
    case 'i':
      controlsDiv.innerHTML = `
        <label for="icon-class">Icon Class</label>
        <input type="text" id="icon-class" value="${selectedElement.className}">
        <label for="icon-color">Icon Color</label>
        <input type="color" id="icon-color" value="${getComputedStyle(selectedElement).color}">
        <label for="icon-size">Icon Size</label>
        <input type="range" id="icon-size" min="12" max="72" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
      `;
      break;
    case 'hr':
      controlsDiv.innerHTML = `
        <label for="divider-color">Color</label>
        <input type="color" id="divider-color" value="${getComputedStyle(selectedElement).borderColor}">
        <label for="divider-style">Style</label>
        <select id="divider-style">
          <option value="solid" ${getComputedStyle(selectedElement).borderStyle === 'solid' ? 'selected' : ''}>Solid</option>
          <option value="dashed" ${getComputedStyle(selectedElement).borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>
          <option value="dotted" ${getComputedStyle(selectedElement).borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>
        </select>
        <label for="divider-thickness">Thickness</label>
        <input type="range" id="divider-thickness" min="1" max="10" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
      `;
      break;
    case 'table':
      controlsDiv.innerHTML = `
      <label for="table-rows">Rows</label>
      <input type="number" id="table-rows" min="1" value="${selectedElement.getAttribute('data-rows')}">
      <label for="table-columns">Columns</label>
      <input type="number" id="table-columns" min="1" value="${selectedElement.getAttribute('data-columns')}">
      <button id="update-table">Update Table</button><br>
      <label for="table-border">Border</label>
      <input type="checkbox" id="table-border" ${selectedElement.style.border ? 'checked' : ''}>
      <label for="table-striped">Striped Rows</label>
      <input type="checkbox" id="table-striped" ${selectedElement.classList.contains('striped') ? 'checked' : ''}>
      <button id="edit-table-content">Edit Table Content</button>
    `;
      break;
    case 'ul':
    case 'ol':
      // List controls
      controlsDiv.innerHTML = `
        <label for="list-type">List Type</label>
        <select id="list-type">
          <option value="ul" ${elementType === 'ul' ? 'selected' : ''}>Unordered</option>
          <option value="ol" ${elementType === 'ol' ? 'selected' : ''}>Ordered</option>
        </select>
        <label for="list-style">List Style</label>
        <select id="list-style">
          <option value="disc" ${getComputedStyle(selectedElement).listStyleType === 'disc' ? 'selected' : ''}>Disc</option>
          <option value="circle" ${getComputedStyle(selectedElement).listStyleType === 'circle' ? 'selected' : ''}>Circle</option>
          <option value="square" ${getComputedStyle(selectedElement).listStyleType === 'square' ? 'selected' : ''}>Square</option>
          <option value="decimal" ${getComputedStyle(selectedElement).listStyleType === 'decimal' ? 'selected' : ''}>Decimal</option>
          <option value="lower-alpha" ${getComputedStyle(selectedElement).listStyleType === 'lower-alpha' ? 'selected' : ''}>Lower Alpha</option>
          <option value="upper-alpha" ${getComputedStyle(selectedElement).listStyleType === 'upper-alpha' ? 'selected' : ''}>Upper Alpha</option>
        </select>
        <button id="add-list-item">Add Item</button>
      `;
      break;

      }
      document.querySelectorAll('#custom-controls input, #custom-controls select').forEach(input => {
        input.addEventListener('input', () => {
          updateElementProperty(input.id, input.value);
        });
      });
      
      
      
        document.getElementById('update-table')?.addEventListener('click', updateTable);
  document.getElementById('update-toc')?.addEventListener('click', updateTableOfContents);
  document.getElementById('add-list-item')?.addEventListener('click', addListItem);
    }

    function rgbToHex(rgb) {
      let sep = rgb.indexOf(",") > -1 ? "," : " ";
      rgb = rgb.substr(4).split(")")[0].split(sep);
      let r = (+rgb[0]).toString(16),
        g = (+rgb[1]).toString(16),
        b = (+rgb[2]).toString(16);
      if (r.length == 1)
        r = "0" + r;
      if (g.length == 1)
        g = "0" + g;
      if (b.length == 1)
        b = "0" + b;
      return "#" + r + g + b;
    }

    function updateElementProperty(propertyName, value) {
      switch (propertyName) {
        case 'text-content':
        case 'button-text':
          selectedElement.textContent = value;
          break;
        case 'text-color':
        case 'button-color':
          selectedElement.style.color = value;
          break;
        case 'text-size':
          selectedElement.style.fontSize = `${value}px`;
          break;
        case 'button-bg':
          selectedElement.style.backgroundColor = value;
          break;
        case 'image-src':
          selectedElement.src = value;
          break;
        case 'image-alt':
          selectedElement.alt = value;
          break;
          case 'input-type':
      selectedElement.type = value;
      break;
    case 'input-placeholder':
      selectedElement.placeholder = value;
      break;
    case 'input-required':
      selectedElement.required = value;
      break;
    case 'heading-text':
      selectedElement.textContent = value;
      break;
    case 'heading-size':
      const newHeading = document.createElement(value);
      newHeading.textContent = selectedElement.textContent;
      newHeading.style.cssText = selectedElement.style.cssText;
      selectedElement.parentNode.replaceChild(newHeading, selectedElement);
      selectedElement = newHeading;
      break;
          case 'icon-class':
      selectedElement.className = value;
      break;
    case 'icon-color':
      selectedElement.style.backgroundColor = value;
      break;
    case 'icon-size':
      selectedElement.style.fontSize = `${value}px`;
      break;
    case 'divider-color':
      selectedElement.style.borderColor = value;
      break;
    case 'divider-style':
      selectedElement.style.borderStyle = value;
      break;
    case 'divider-thickness':
      selectedElement.style.borderWidth = `${value}px`;
      break;
    case 'table-border':
      selectedElement.style.border = value ? '1px solid black' : 'none';
      selectedElement.style.borderCollapse = value ? 'collapse' : 'separate';
      break;
    case 'table-striped':
      selectedElement.classList.toggle('striped', value);
      break;
    case 'list-type':
      const newList = document.createElement(value);
      newList.innerHTML = selectedElement.innerHTML;
      selectedElement.parentNode.replaceChild(newList, selectedElement);
      selectedElement = newList;
      break;
    case 'list-style':
      selectedElement.style.listStyleType = value;
      break;
    case 'toc-depth':
      selectedElement.setAttribute('data-depth', value);
      break;
      }
      updateCode();
    }

function updateCode() {
  let htmlCode = '';
  let cssCode = '';
  
  document.querySelectorAll('.draggable-element').forEach(el => {
    const style = getComputedStyle(el);
    cssCode += `
.${el.className.replace(/\s+/g, '.')}.${el.getAttribute('data-type')} {
    ${style.backgroundImage && style.backgroundImage !== 'none' ? `background-image: ${style.backgroundImage};` : `background-color: ${style.backgroundColor};`}
    color: ${style.color};
    font-size: ${style.fontSize};
    margin: ${style.margin};
    padding: ${style.padding};
    border: ${style.border};
    width: ${style.width};
    height: ${style.height};
    z-index: ${style.zIndex};
    position: absolute;
    left: ${el.style.left};
    top: ${el.style.top};
}
    `;
  });

  canvas.childNodes.forEach(el => {
    if (el.nodeType === Node.ELEMENT_NODE) {
      htmlCode += el.outerHTML + '\n';
    }
  });

  codePreview.textContent = `
<style>
    ${cssCode}
</style>
${htmlCode}
    `;
}


    document.querySelectorAll('.draggable-element').forEach(element => {
      element.addEventListener('click', function() {
        if (selectedElement) {
          selectedElement.classList.remove('selected');
        }
        selectedElement = this;
        selectedElement.classList.add('selected');
      });
    });
    
    
document.getElementById('open-popup').addEventListener('click', function() {
  if (selectedElement) {
    document.getElementById('css-popup').style.display = 'block';
    const style = getComputedStyle(selectedElement);
    
    if (style.backgroundImage && style.backgroundImage.includes('gradient')) {
      document.getElementById('bg-type').value = 'gradient';
      document.getElementById('gradient-bg').style.display = 'block';
      document.getElementById('solid-bg').style.display = 'none';

      document.getElementById('bg-gradient').value = style.backgroundImage;
    } else {
      document.getElementById('bg-type').value = 'solid';
      document.getElementById('solid-bg').style.display = 'block';
      document.getElementById('gradient-bg').style.display = 'none';

      document.getElementById('bg-color').value = rgbToHex(style.backgroundColor);
    }

    document.getElementById('color').value = rgbToHex(style.color);
    document.getElementById('font-size').value = style.fontSize;
    document.getElementById('margin').value = style.margin;
    document.getElementById('padding').value = style.padding;
    document.getElementById('border').value = style.border;
    document.getElementById('width').value = style.width;
    document.getElementById('height').value = style.height;
    document.getElementById('z-index').value = style.zIndex;
    document.getElementById('custom-css').value = '';
  } else {
    alert('Please select an element first.');
  }
});



document.getElementById('apply-css').addEventListener('click', function() {
  if (selectedElement) {
    const bgType = document.getElementById('bg-type').value;
    const bgColor = document.getElementById('bg-color').value;
    const bgGradient = document.getElementById('bg-gradient').value;
    const color = document.getElementById('color').value;
    const fontSize = document.getElementById('font-size').value;
    const margin = document.getElementById('margin').value;
    const padding = document.getElementById('padding').value;
    const border = document.getElementById('border').value;
    const width = document.getElementById('width').value;
    const height = document.getElementById('height').value;
    const zIndex = document.getElementById('z-index').value;

    if (bgType === 'solid' && bgColor) {
      selectedElement.style.backgroundColor = bgColor;
      selectedElement.style.backgroundImage = 'none';
    } else if (bgType === 'gradient' && bgGradient) {
      selectedElement.style.backgroundImage = bgGradient;
      selectedElement.style.backgroundColor = 'transparent';
    }

    if (color) selectedElement.style.color = color;
    if (fontSize) selectedElement.style.fontSize = fontSize;
    if (margin) selectedElement.style.margin = margin;
    if (padding) selectedElement.style.padding = padding;
    if (border) selectedElement.style.border = border;
    if (width) selectedElement.style.width = width;
    if (height) selectedElement.style.height = height;
    if (zIndex) selectedElement.style.zIndex = zIndex;

    updateCode();
  }
});


document.getElementById('apply-custom-css').addEventListener('click', function() {
  if (selectedElement) {
    const customCss = document.getElementById('custom-css').value;
    selectedElement.style.cssText += `;${customCss}`;
    updateCode();
  }
});

    document.getElementById('close-popup').addEventListener('click', function() {
      document.getElementById('css-popup').style.display = 'none';
    });
    document.getElementById('download-code').addEventListener('click', () => {
      const htmlContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Generated Website</title>
    </head>
    <body>
      ${codePreview.textContent}
    </body>
    </html>
  `;
      const blob = new Blob([htmlContent], {
        type: 'text/html'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'generated_website.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
    updateCode();
    canvas.addEventListener('dragover', event => {
      event.preventDefault();
    });
canvas.addEventListener('drop', event => {
  event.preventDefault();

  handleStateChange();

  const type = event.dataTransfer.getData('type');
  const newElement = createElement(type);
  const rect = canvas.getBoundingClientRect();
  newElement.style.left = `${snapToGrid(event.clientX - rect.left)}px`; 
  newElement.style.top = `${snapToGrid(event.clientY - rect.top)}px`;
  canvas.appendChild(newElement);
  addResizeHandles(newElement);
  newElement.addEventListener('mousedown', startDrag); 
  makeDraggable(newElement);

  updateCode();

  console.log('Element dropped and state captured');
});

    canvas.addEventListener('mousedown', event => {
      const target = event.target.closest('.draggable');
      if (target) {
        startDrag(event);
      }
    });
    document.querySelectorAll('.draggable-element').forEach(element => {
      element.addEventListener('dragstart', event => {
        event.dataTransfer.setData('type', element.getAttribute('data-type'));
      });
    });

document.addEventListener('keydown', function(event) {
  if ((event.key === 'Delete' || event.key === 'Backspace') && event.shiftKey && selectedElement) { 
    event.preventDefault();
    try {
      canvas.removeChild(selectedElement);
      console.log('Element removed:', selectedElement);
    } catch (error) {
      console.error('Error removing element:', error);
    }
    selectedElement = null; 
    updateControls();
    handleStateChange();
    updateCode();
  } else if ((event.key === 'Delete' || event.key === 'Backspace') && !event.shiftKey) {
    showText('Press Shift+Delete to remove element', 1000);
  }
});


function makeDraggable(element) {
  let isDragging = false;
  let offsetX, offsetY;

  element.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - element.getBoundingClientRect().left;
    offsetY = e.clientY - element.getBoundingClientRect().top;
    handleStateChange(); 
  });

  window.addEventListener('mousemove', (e) => {
    if (isDragging) {
      const rect = canvas.getBoundingClientRect();
      const x = snapToGrid(e.clientX - rect.left - offsetX); 
      const y = snapToGrid(e.clientY - rect.top - offsetY);
      element.style.left = `${x}px`;
      element.style.top = `${y}px`;
    }
  });

  window.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      handleStateChange();
      updateCode();
      console.log('Element dragged and state captured');
    }
  });
}


    function getCSSCode() {
      let cssCode = '';
      document.querySelectorAll('.draggable-element').forEach(el => {
        const style = getComputedStyle(el);
        cssCode += `
        .${el.className.replace(/\s+/g, '.')}.${el.getAttribute('data-type')} {
            background-color: ${style.backgroundColor};
            color: ${style.color};
            font-size: ${style.fontSize};
            margin: ${style.margin};
            padding: ${style.padding};
            border: ${style.border};
            width: ${style.width};
            height: ${style.height};
            position: absolute;
            left: ${el.style.left};
            top: ${el.style.top};
        }
        `;
      });
      return cssCode;
    }

function updateCanvasAndCode(state) {
  canvas.innerHTML = state.htmlCode;
  codePreview.textContent = `<style>${state.cssCode}</style>${state.htmlCode}`;
  
  canvas.querySelectorAll('.draggable').forEach(element => {
    element.addEventListener('mousedown', startDrag);
    makeDraggable(element);
    addResizeHandles(element);
  });
}

    function captureState() {
      const htmlCode = canvas.innerHTML;
      const cssCode = getCSSCode();
      return { htmlCode, cssCode };
    }


    function undo() {
      if (undoStack.length > 0) {
        const state = undoStack.pop();
        redoStack.push(captureState());
        updateCanvasAndCode(state);
      }
    }

    function redo() {
      if (redoStack.length > 0) {
        const state = redoStack.pop();
        undoStack.push(captureState());
        updateCanvasAndCode(state);
      }
    }
    document.getElementById('undo-button').addEventListener('click', undo);
    document.getElementById('redo-button').addEventListener('click', redo);
    canvas.addEventListener('drop', () => {
      handleStateChange();
      updateCode();
    });
    document.getElementById('apply-css').addEventListener('click', () => {
      handleStateChange();
      updateCode();
    });
    document.getElementById('delete-element').addEventListener('click', () => {
      handleStateChange();
      updateCode();
    });

    function makePopupDraggable(popup, header) {
      let isDragging = false;
      let offsetX, offsetY;
      header.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - popup.getBoundingClientRect().left;
        offsetY = e.clientY - popup.getBoundingClientRect().top;
      });
      window.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const x = e.clientX - offsetX;
          const y = e.clientY - offsetY;
          popup.style.left = `${x}px`;
          popup.style.top = `${y}px`;
        }
      });
      window.addEventListener('mouseup', () => {
        isDragging = false;
      });
    }
    const cssPopup = document.getElementById('css-popup');
    const popupHeader = document.getElementById('popup-header');
    makePopupDraggable(cssPopup, popupHeader);

    function showText(text, duration) {
      const element = document.getElementById('disappearingText');
      element.textContent = text;
      element.style.opacity = '1';
      setTimeout(() => {
        element.style.opacity = '0';
        element.textContent = '';
      }, duration);
    }

function updateTable() {
  const rows = parseInt(document.getElementById('table-rows').value);
  const columns = parseInt(document.getElementById('table-columns').value);
  let tableHTML = '';
  for (let i = 0; i < rows; i++) {
    tableHTML += '<tr>';
    for (let j = 0; j < columns; j++) {
      tableHTML += i === 0 ? '<th>Header</th>' : '<td>Cell</td>';
    }
    tableHTML += '</tr>';
  }
  selectedElement.innerHTML = tableHTML;
  selectedElement.setAttribute('data-rows', rows);
  selectedElement.setAttribute('data-columns', columns);
  addResizeHandles(selectedElement);
  updateCode();
  handleStateChange();
}

function editTableContent() {
  const rows = parseInt(selectedElement.getAttribute('data-rows'));
  const columns = parseInt(selectedElement.getAttribute('data-columns'));
  let editHTML = '<table>';
  
  // Add column headers with add/remove buttons
  editHTML += '<tr><th></th>';
  for (let j = 0; j < columns; j++) {
    editHTML += `<th>
      Column ${j + 1}
      <button class="remove-column" data-col="${j}">-</button>
    </th>`;
  }
  editHTML += `<th><button id="add-column">+</button></th></tr>`;

  // Add rows with editable cells and add/remove buttons
  for (let i = 0; i < rows; i++) {
    editHTML += `<tr>
      <td>
        <button class="remove-row" data-row="${i}">-</button>
      </td>`;
    for (let j = 0; j < columns; j++) {
      const cellContent = selectedElement.rows[i].cells[j].textContent;
      editHTML += `<td><input type="text" value="${cellContent}" data-row="${i}" data-col="${j}"></td>`;
    }
    editHTML += '<td></td></tr>';
  }

  // Add row at the bottom
  editHTML += `<tr><td><button id="add-row">+</button></td></tr>`;

  editHTML += '</table>';
  editHTML += '<button id="save-table-content">Save</button>';

  const editPopup = document.createElement('div');
  editPopup.innerHTML = editHTML;
  editPopup.style.position = 'fixed';
  editPopup.style.top = '50%';
  editPopup.style.left = '50%';
  editPopup.style.transform = 'translate(-50%, -50%)';
  editPopup.style.backgroundColor = 'white';
  editPopup.style.padding = '20px';
  editPopup.style.border = '1px solid black';
  editPopup.style.zIndex = '1000';
  editPopup.style.maxHeight = '80vh';
  editPopup.style.overflowY = 'auto';

  document.body.appendChild(editPopup);

  // Event listener for adding a row
  document.getElementById('add-row').addEventListener('click', () => {
    const newRow = document.createElement('tr');
    newRow.innerHTML = `<td><button class="remove-row" data-row="${rows}">-</button></td>`;
    for (let j = 0; j < columns; j++) {
      newRow.innerHTML += `<td><input type="text" value="" data-row="${rows}" data-col="${j}"></td>`;
    }
    newRow.innerHTML += '<td></td>';
    editPopup.querySelector('table').insertBefore(newRow, editPopup.querySelector('#add-row').parentNode.parentNode);
    rows++;
  });

  // Event listener for adding a column
  document.getElementById('add-column').addEventListener('click', () => {
    const headerRow = editPopup.querySelector('table tr');
    const newHeader = document.createElement('th');
    newHeader.innerHTML = `Column ${columns + 1} <button class="remove-column" data-col="${columns}">-</button>`;
    headerRow.insertBefore(newHeader, headerRow.lastElementChild);

    const dataRows = editPopup.querySelectorAll('table tr:not(:first-child):not(:last-child)');
    dataRows.forEach((row, i) => {
      const newCell = document.createElement('td');
      newCell.innerHTML = `<input type="text" value="" data-row="${i}" data-col="${columns}">`;
      row.insertBefore(newCell, row.lastElementChild);
    });
    columns++;
  });

  // Event delegation for removing rows and columns
  editPopup.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-row')) {
      const rowIndex = parseInt(e.target.getAttribute('data-row'));
      editPopup.querySelector(`tr:nth-child(${rowIndex + 2})`).remove();
      rows--;
    } else if (e.target.classList.contains('remove-column')) {
      const colIndex = parseInt(e.target.getAttribute('data-col'));
      editPopup.querySelectorAll('tr').forEach(row => {
        row.querySelector(`td:nth-child(${colIndex + 2}), th:nth-child(${colIndex + 2})`).remove();
      });
      columns--;
    }
  });

  // Save button event listener
  document.getElementById('save-table-content').addEventListener('click', () => {
    // Create a new table with the updated content
    const newTable = document.createElement('table');
    newTable.innerHTML = '<tbody></tbody>';
    const tbody = newTable.querySelector('tbody');

    const inputs = editPopup.querySelectorAll('input');
    let currentRow;
    inputs.forEach(input => {
      const row = parseInt(input.getAttribute('data-row'));
      const col = parseInt(input.getAttribute('data-col'));
      
      if (!currentRow || currentRow.rowIndex !== row) {
        currentRow = tbody.insertRow();
      }
      
      const cell = currentRow.insertCell();
      cell.textContent = input.value;
    });

    // Replace the old table with the new one
    selectedElement.innerHTML = newTable.innerHTML;
    selectedElement.setAttribute('data-rows', rows);
    selectedElement.setAttribute('data-columns', columns);

    document.body.removeChild(editPopup);
    updateCode();
    handleStateChange();
  });
}

// Make sure to keep the event listener for the edit button
document.getElementById('edit-table-content').addEventListener('click', editTableContent);


function addListItem() {
  const newItem = document.createElement('li');
  newItem.textContent = 'New Item';
  selectedElement.appendChild(newItem);
  updateCode();
}

document.getElementById('platform-checkboxes')?.addEventListener('change', (e) => {
  if (e.target.type === 'checkbox') {
    const platforms = Array.from(document.querySelectorAll('#platform-checkboxes input:checked'))
      .map(checkbox => checkbox.id.replace('-checkbox', ''));
    selectedElement.innerHTML = platforms.map(platform => 
      `<a href="#" class="fa fa-${platform}"></a>`
    ).join(' ');
    selectedElement.setAttribute('data-platforms', platforms.join(','));
    updateCode();
  }
});

document.getElementById('bg-type').addEventListener('change', function() {
  const bgType = this.value;
  if (bgType === 'solid') {
    document.getElementById('solid-bg').style.display = 'block';
    document.getElementById('gradient-bg').style.display = 'none';
  } else if (bgType === 'gradient') {
    document.getElementById('solid-bg').style.display = 'none';
    document.getElementById('gradient-bg').style.display = 'block';
  }
});


function rgbToHex(rgb) {
  const result = /^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(rgb);
  return result ? 
    "#" + 
    ("0" + parseInt(result[1],10).toString(16)).slice(-2) + 
    ("0" + parseInt(result[2],10).toString(16)).slice(-2) + 
    ("0" + parseInt(result[3],10).toString(16)).slice(-2) 
    : '#ffffff';
}
  </script>
</body><!DOCTYPE html>
<html lang="en">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: 'Roboto', sans-serif;
    }

    #main-container {
      flex-grow: 1;
      display: flex;
    }

    #canvas {
      flex-grow: 1;
      border: 2px dashed #ccc;
      background-color: #ffffff;
      padding: 20px;
      position: relative;
      overflow: auto;
      background-image: linear-gradient(to right, #eee 1px, transparent 1px),
        linear-gradient(to bottom, #eee 1px, transparent 1px);
      background-size: 20px 20px;
    }

    #footer {
      height: 150px;
      background-color: #f4f4f4;
      padding: 20px;
      display: flex;
      border: 2px solid #ff7e5f;
    }

    #sidebar {
      width: 30%;
      padding: 20px;
      overflow-y: auto;
    }

    #code-output {
      width: 70%;
      background-color: #f1f1f1;
      padding: 20px;
      overflow-y: scroll;
      border: 2px solid #ff7e5f;
      margin-right: 15px;
    }

    .draggable-element {
      border: 2px solid #ff7e5f;
      padding: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      text-align: center;
    }

    .selected-element {
      outline: 2px solid #ff7e5f;
      position: relative;
    }

    .resizable {
      position: relative;
      display: inline-block;
    }

    .resizable .resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ff7e5f;
      border-radius: 50%;
      cursor: nwse-resize;
    }

    .resize-handle.tl {
      top: -5px;
      left: -5px;
    }

.custom-button {
    position: relative;
    display: inline-block;
    padding: 12px 24px;
    font-size: 1.1em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #fff;
    background: linear-gradient(to right, #ff7e5f, #feb47b);
    border: 2px solid #ff7e5f;
    text-align: center;
    cursor: pointer;
    transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    outline: none;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

    .resize-handle.tr {
      top: -5px;
      right: -5px;
    }

    .resize-handle.br {
      bottom: -5px;
      right: -5px;
    }

    .resize-handle.bl {
      bottom: -5px;
      left: -5px;
    }

    .controls {
      margin-top: 20px;
    }

    .controls input,
    .controls select {
      width: 100%;
      margin-bottom: 10px;
    }

    

    #css-popup {
      display: none;
      position: absolute;
      top: 50px;
      left: 61%;
      width: 300px;
      background-color: white;
      border: 1px solid #ddd;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 10;
      cursor: move;
      transform: scale(0.7);
    }

    #css-popup input,
    #css-popup select {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }

    #css-popup button {
      margin-top: 10px;
    }

    #popup-header {
      background-color: #ff7e5f;
      color: white;
      padding: 10px;
      cursor: move;
      text-align: center;
      font-weight: bold;
    }

    #buttons-container {
      display: flex;
      gap: 10px;
    }

    .undo-button {
      padding: 10px 20px;
      border: 1px solid #ddd;
      background-color: #007bff;
      color: white;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
    }

    .undo-button:hover {
      background-color: #0056b3;
    }

    #disappearingText {
      opacity: 0;
      transition: opacity 1.4s ease-in-out;
      text-align: right;
      font-weight: bold;
      background-color: #f4f4f4;
      font-size: 0.3em;
    }
    
    .custom-button:hover,
.custom-button:focus {
    background: linear-gradient(to right, #feb47b, #ff7e5f);
    color: #05060f;
    border-color: #feb47b;
}

.custom-button:active {
    background: #ff7e5f;
    color: #fff;
    border-color: #ff7e5f;
}
  </style>
</head>

<body>
  <div id="main-container">

    <div id="canvas"></div>

  </div>
  
  <div id="footer">

    <div id="sidebar">
      <h2>Elements</h2>
<div class="draggable-element" draggable="true" data-type="text">Text</div>
<div class="draggable-element" draggable="true" data-type="button">Button</div>
<div class="draggable-element" draggable="true" data-type="image">Image</div>
<div class="draggable-element" draggable="true" data-type="form">Form</div>
<div class="draggable-element" draggable="true" data-type="video">Video</div>
<div class="draggable-element" draggable="true" data-type="contact-form">Contact Form</div>
<div class="draggable-element" draggable="true" data-type="input">Input Field</div>
<div class="draggable-element" draggable="true" data-type="heading">Heading</div>
<div class="draggable-element" draggable="true" data-type="paragraph">Paragraph</div>
<div class="draggable-element" draggable="true" data-type="list">List</div>
<div class="draggable-element" draggable="true" data-type="table">Table</div>
<div class="draggable-element" draggable="true" data-type="icon">Icon</div>


      <div id="custom-controls" class="controls">
      </div>

      <h3>Additional Options</h3>
      <button id="open-popup" class="custom-button">Custom CSS</button>
      <br><br>
      <button id="add-js" class="custom-button">Custom JS</button>
<br><br>
      <center><a href="/docs">
  <button class="custom-button">Docs</button>
</a></center>
    </div>

    <div id="code-output">
      <h2>Code</h2>
      <pre id="code-preview"></pre>
      <button id="download-code" class="custom-button">Download Code</button>
    </div>

    <div id="buttons-container">
      <div id="undo-button" class="button">⤶</div>
      <div id="redo-button" class="button">⤷</div>
    </div>
    
  </div>
  <div id="disappearingText"></div>

  <div id="css-popup" style="display: none; /* Ensure it's hidden by default */">
  <div id="popup-header">CSS Editor</div>

  <label for="bg-type">Background Type:</label>
  <select id="bg-type">
    <option value="solid">Solid Color</option>
    <option value="gradient">Gradient</option>
  </select>

  <div id="solid-bg">
    <label for="bg-color">Background Color:</label>
    <input type="color" id="bg-color" placeholder="e.g., #3498db">
  </div>
  
  <div id="gradient-bg" style="display: none;">
    <label for="bg-gradient">Background Gradient:</label>
    <input type="text" id="bg-gradient" placeholder="e.g., linear-gradient(to right, #ff7e5f, #feb47b)">
  </div>

  <label for="color">Text Color:</label>
  <input type="color" id="color" placeholder="e.g., #ffffff">

  <label for="font-size">Font Size:</label>
  <select id="font-size">
    <option value="">Select font size</option>
    <option value="12px">12px</option>
    <option value="14px">14px</option>
    <option value="16px">16px</option>
    <option value="18px">18px</option>
    <option value="20px">20px</option>
  </select>

  <label for="margin">Margin:</label>
  <input type="text" id="margin" placeholder="e.g., 10px">

  <label for="padding">Padding:</label>
  <input type="text" id="padding" placeholder="e.g., 10px">

  <label for="border">Border:</label>
  <input type="text" id="border" placeholder="e.g., 1px solid #2980b9">

  <label for="width">Width:</label>
  <input type="text" id="width" placeholder="e.g., 50px">

  <label for="height">Height:</label>
  <input type="text" id="height" placeholder="e.g., 50px">

  <label for="z-index">Z-Index:</label>
  <input type="number" id="z-index" placeholder="e.g., 1">

  <label for="custom-css">Written CSS:</label><br>
  <textarea id="custom-css" rows="4" placeholder="Enter custom CSS here..."></textarea><br>

  <button id="apply-css">Apply CSS</button>
  or
  <button id="apply-custom-css">Apply Written CSS</button>
  <button id="close-popup">Close</button>
</div>


  <script>
    let undoStack = [];
    let redoStack = [];
    const MAX_STACK_SIZE = 100;

function handleStateChange() {
  const state = captureState();

  if (undoStack.length >= MAX_STACK_SIZE) {
    undoStack.shift(); 
  }
  undoStack.push(state);

  redoStack = [];

  console.log('State captured and pushed to undoStack:', state);
  console.log('Current undoStack size:', undoStack.length);
  console.log('redoStack cleared');
}

    let selectedElement = null;
    const canvas = document.getElementById('canvas');
    const codePreview = document.getElementById('code-preview');
    const GRID_SIZE = 20; // Grid size in pixels
    function snapToGrid(value) {
      return Math.round(value / GRID_SIZE) * GRID_SIZE;
    }

    function createElement(type, placeholders = {}) {
      let newElement;
      switch (type) {
        case 'text':
          newElement = document.createElement('p');
          newElement.textContent = 'New Text';
          break;
        case 'button':
          newElement = document.createElement('button');
          newElement.textContent = 'New Button';
          break;
        case 'image':
          newElement = document.createElement('img');
          newElement.src = 'https://via.placeholder.com/150';
          break;
        case 'form':
          newElement = document.createElement('form');
          newElement.innerHTML = `
        <input type="text" placeholder="${placeholders.name || 'Placeholder'}">
        <input type="email" placeholder="${placeholders.email || 'Placeholder'}">
        <button type="submit">Submit</button>
      `;
          break;
        case 'text-placeholder':
          selectedElement.querySelector('input[type="text"]').placeholder = value;
          break;
        case 'email-placeholder':
          selectedElement.querySelector('input[type="email"]').placeholder = value;
          break;
        case 'carousel':
          newElement = document.createElement('div');
          newElement.className = 'carousel';
          newElement.innerHTML = `
        <div class="carousel-slide">Slide 1</div>
        <div class="carousel-slide">Slide 2</div>
        <div class="carousel-slide">Slide 3</div>
      `;
          break;
        case 'video':
          newElement = document.createElement('video');
          newElement.controls = true;
          newElement.src = 'https://www.w3schools.com/html/mov_bbb.mp4';
          break;
        case 'contact-form':
          newElement = document.createElement('form');
          newElement.className = 'contact-form';
          newElement.innerHTML = `
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" placeholder="${placeholders.name || ''}">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="${placeholders.email || ''}">
        <label for="message">Message:</label>
        <textarea id="message" name="message" placeholder="${placeholders.message || ''}"></textarea>
        <button type="submit">Send</button>
      `;
          break;
case 'input':
      newElement = document.createElement('input');
      newElement.type = 'text';
      newElement.placeholder = 'Enter text here';
      break;
    case 'heading':
      newElement = document.createElement('h2');
      newElement.textContent = 'New Heading';
      break;
    case 'paragraph':
      newElement = document.createElement('p');
      newElement.textContent = 'This is a new paragraph. Double-click to edit.';
      break;
    case 'social-media':
      newElement = document.createElement('div');
      newElement.innerHTML = '<a href="#" class="fa fa-facebook"></a> <a href="#" class="fa fa-twitter"></a> <a href="#" class="fa fa-instagram"></a>';
      newElement.setAttribute('data-platforms', 'facebook,twitter,instagram');
      break;
    case 'icon':
      newElement = document.createElement('i');
      newElement.className = 'fas fa-star';
      break;
    case 'divider':
      newElement = document.createElement('hr');
      break;
    case 'table':
      newElement = document.createElement('table');
      newElement.innerHTML = '<tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Row 1, Cell 1</td><td>Row 1, Cell 2</td></tr>';
      newElement.setAttribute('data-rows', '2');
      newElement.setAttribute('data-columns', '2');
      break;
    case 'list':
      newElement = document.createElement('ul');
      newElement.innerHTML = '<li>Item 1</li><li>Item 2</li><li>Item 3</li>';
      break;
    case 'table-of-contents':
      newElement = document.createElement('div');
      newElement.innerHTML = '<h3>Table of Contents</h3><ul><li><a href="#section1">Section 1</a></li><li><a href="#section2">Section 2</a></li></ul>';
      newElement.setAttribute('data-depth', '1');
      break;
  }
  
newElement.style.position = 'absolute';
  newElement.classList.add('draggable');
  newElement.classList.add('resizable');
  addResizeHandles(newElement);
  return newElement;
}

function addResizeHandles(element) {
  const handles = ['tl', 'tr', 'br', 'bl'];
  handles.forEach(handle => {
    const div = document.createElement('div');
    div.className = `resize-handle ${handle}`;
    element.appendChild(div);
    div.addEventListener('mousedown', event => initResize(event, element));
  });
}

function initResize(event, element) {
  event.preventDefault();
  event.stopPropagation();
  const handle = event.target.className.split(' ')[1];
  const startX = event.clientX;
  const startY = event.clientY;
  const startWidth = parseInt(getComputedStyle(element).width);
  const startHeight = parseInt(getComputedStyle(element).height);
  const startLeft = parseInt(element.style.left);
  const startTop = parseInt(element.style.top);

  function resizeMove(moveEvent) {
    let newWidth = startWidth;
    let newHeight = startHeight;
    let newLeft = startLeft;
    let newTop = startTop;
    if (handle.includes('r')) {
      newWidth = snapToGrid(startWidth + moveEvent.clientX - startX);
    } else if (handle.includes('l')) {
      const dx = snapToGrid(moveEvent.clientX - startX);
      newWidth = startWidth - dx;
      newLeft = startLeft + dx;
    }
    if (handle.includes('b')) {
      newHeight = snapToGrid(startHeight + moveEvent.clientY - startY);
    } else if (handle.includes('t')) {
      const dy = snapToGrid(moveEvent.clientY - startY);
      newHeight = startHeight - dy;
      newTop = startTop + dy;
    }
    element.style.width = `${newWidth}px`;
    element.style.height = `${newHeight}px`;
    element.style.left = `${newLeft}px`;
    element.style.top = `${newTop}px`;
  }

  function resizeEnd() {
    document.removeEventListener('mousemove', resizeMove);
    document.removeEventListener('mouseup', resizeEnd);
    handleStateChange();
    updateCode();
  }
  document.addEventListener('mousemove', resizeMove);
  document.addEventListener('mouseup', resizeEnd);
}

    function startDrag(event) {
      const target = event.target.closest('.draggable');
      if (!target) return;
      event.preventDefault();
      selectElement(target);
      const startX = event.clientX;
      const startY = event.clientY;
      const startLeft = parseInt(target.style.left) || 0;
      const startTop = parseInt(target.style.top) || 0;

      function dragMove(moveEvent) {
        const dx = moveEvent.clientX - startX;
        const dy = moveEvent.clientY - startY;
        const newLeft = snapToGrid(startLeft + dx);
        const newTop = snapToGrid(startTop + dy);
        target.style.left = `${newLeft}px`;
        target.style.top = `${newTop}px`;
      }

      function dragEnd() {
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        updateCode();
      }
      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', dragEnd);
    }

    function addResizeHandles(element) {
      const handles = ['tl', 'tr', 'br', 'bl'];
      handles.forEach(handle => {
        const div = document.createElement('div');
        div.className = `resize-handle ${handle}`;
        element.appendChild(div);
        div.addEventListener('mousedown', event => initResize(event, element));
      });
    }

    function initResize(event, element) {
      event.preventDefault();
      event.stopPropagation();
      const handle = event.target.className.split(' ')[1];
      const startX = event.clientX;
      const startY = event.clientY;
      const startWidth = parseInt(getComputedStyle(element).width);
      const startHeight = parseInt(getComputedStyle(element).height);
      const startLeft = parseInt(element.style.left);
      const startTop = parseInt(element.style.top);

      function resizeMove(moveEvent) {
        let newWidth = startWidth;
        let newHeight = startHeight;
        let newLeft = startLeft;
        let newTop = startTop;
        if (handle.includes('r')) {
          newWidth = snapToGrid(startWidth + moveEvent.clientX - startX);
        } else if (handle.includes('l')) {
          const dx = snapToGrid(moveEvent.clientX - startX);
          newWidth = startWidth - dx;
          newLeft = startLeft + dx;
        }
        if (handle.includes('b')) {
          newHeight = snapToGrid(startHeight + moveEvent.clientY - startY);
        } else if (handle.includes('t')) {
          const dy = snapToGrid(moveEvent.clientY - startY);
          newHeight = startHeight - dy;
          newTop = startTop + dy;
        }
        element.style.width = `${newWidth}px`;
        element.style.height = `${newHeight}px`;
        element.style.left = `${newLeft}px`;
        element.style.top = `${newTop}px`;
      }

      function resizeEnd() {
        document.removeEventListener('mousemove', resizeMove);
        document.removeEventListener('mouseup', resizeEnd);
        updateCode();
      }
      document.addEventListener('mousemove', resizeMove);
      document.addEventListener('mouseup', resizeEnd);
    }

    function selectElement(element) {
      if (selectedElement) {
        selectedElement.classList.remove('selected-element');
      }
      selectedElement = element;
      selectedElement.classList.add('selected-element');
      updateControls();
    }

    function updateControls() {
      const controlsDiv = document.getElementById('custom-controls');
      controlsDiv.innerHTML = '';
      if (!selectedElement) return;
      const elementType = selectedElement.tagName.toLowerCase();
      switch (elementType) {
        case 'p':
          controlsDiv.innerHTML = `
    <label for="text-content">Text Content</label>
    <input type="text" id="text-content" value="${selectedElement.textContent}">
    <label for="text-font">Font Family</label>
    <select id="text-font">
        <!-- Add more font options here -->
    </select>
    <label for="text-size">Font Size (px)</label>
    <input type="number" id="text-size" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
    <label for="text-color">Text Color</label>
    <input type="color" id="text-color" value="${getComputedStyle(selectedElement).color}">
    <label for="text-align">Text Align</label>
    <select id="text-align">
        <option value="left" ${getComputedStyle(selectedElement).textAlign === 'left'?'selected' : ''}>Left</option>
        <option value="center" ${getComputedStyle(selectedElement).textAlign === 'center'?'selected' : ''}>Center</option>
        <option value="right" ${getComputedStyle(selectedElement).textAlign === 'right'?'selected' : ''}>Right</option>
    </select>
    <label for="line-height">Line Height</label>
    <input type="number" id="line-height" value="${parseFloat(getComputedStyle(selectedElement).lineHeight)}" step="0.1">
    <label for="letter-spacing">Letter Spacing (px)</label>
    <input type="number" id="letter-spacing" value="${parseFloat(getComputedStyle(selectedElement).letterSpacing)}" step="0.1">
    <label for="font-weight">Font Weight</label>
    <select id="font-weight">
        <option value="normal" ${getComputedStyle(selectedElement).fontWeight === 'normal'?'selected' : ''}>Normal</option>
        <option value="bold" ${getComputedStyle(selectedElement).fontWeight === 'bold'?'selected' : ''}>Bold</option>
    </select>
    <label for="font-style">Font Style</label>
    <select id="font-style">
        <option value="normal" ${getComputedStyle(selectedElement).fontStyle === 'normal'?'selected' : ''}>Normal</option>
        <option value="italic" ${getComputedStyle(selectedElement).fontStyle === 'italic'?'selected' : ''}>Italic</option>
    </select>
`;
          break;
        case 'button':
          controlsDiv.innerHTML = `
    <label for="button-text">Button Text</label>
    <input type="text" id="button-text" value="${selectedElement.textContent}">
    <label for="button-bg">Background Color</label>
    <input type="color" id="button-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
    <label for="button-color">Text Color</label>
    <input type="color" id="button-color" value="${getComputedStyle(selectedElement).color}">
    <label for="button-border">Border (px)</label>
    <input type="number" id="button-border" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
    <label for="button-radius">Border Radius (px)</label>
    <input type="number" id="button-radius" value="${parseInt(getComputedStyle(selectedElement).borderRadius)}">
    <label for="button-font-size">Font Size (px)</label>
    <input type="number" id="button-font-size" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
    <label for="button-font-weight">Font Weight</label>
    <select id="button-font-weight">
        <option value="normal" ${getComputedStyle(selectedElement).fontWeight === 'normal'?'selected' : ''}>Normal</option>
        <option value="bold" ${getComputedStyle(selectedElement).fontWeight === 'bold'?'selected' : ''}>Bold</option>
    </select>
    <label for="button-letter-spacing">Letter Spacing (px)</label>
    <input type="number" id="button-letter-spacing" value="${parseFloat(getComputedStyle(selectedElement).letterSpacing)}" step="0.1">
    <label for="button-padding">Padding (px)</label>
    <input type="number" id="button-padding" value="${parseInt(getComputedStyle(selectedElement).padding)}">
`;
          break;
        case 'img':
          controlsDiv.innerHTML = `
    <label for="image-src">Image Source</label>
    <input type="text" id="image-src" value="${selectedElement.src}">
    <label for="image-width">Width (px)</label>
    <input type="number" id="image-width" value="${parseInt(selectedElement.width)}">
    <label for="image-height">Height (px)</label>
    <input type="number" id="image-height" value="${parseInt(selectedElement.height)}">
    <label for="image-alt">Alt Text</label>
    <input type="text" id="image-alt" value="${selectedElement.alt}">
    <label for="image-border">Border (px)</label>
    <input type="number" id="image-border" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
    <label for="image-radius">Border Radius (px)</label>
    <input type="number" id="image-radius" value="${parseInt(getComputedStyle(selectedElement).borderRadius)}">
    <label for="image-fit">Object Fit</label>
    <select id="image-fit">
        <option value="fill" ${getComputedStyle(selectedElement).objectFit === 'fill'?'selected' : ''}>Fill</option>
        <option value="contain" ${getComputedStyle(selectedElement).objectFit === 'contain'?'selected' : ''}>Contain</option>
        <option value="cover" ${getComputedStyle(selectedElement).objectFit === 'cover'?'selected' : ''}>Cover</option>
    </select>
`;
          break;
        case 'form':
          controlsDiv.innerHTML = `
        <label for="form-action">Form Action URL</label>
        <input type="text" id="form-action" placeholder="Enter form action URL" value="${selectedElement.action || ''}">
        <label for="form-method">Method</label>
        <select id="form-method">
            <option value="get" ${selectedElement.method === 'get'?'selected' : ''}>GET</option>
            <option value="post" ${selectedElement.method === 'post'?'selected' : ''}>POST</option>
        </select>
        <label for="form-bg">Background Color</label>
        <input type="color" id="form-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
        <label for="form-padding">Padding (px)</label>
        <input type="number" id="form-padding" placeholder="Enter padding in px" value="${parseInt(getComputedStyle(selectedElement).padding)}">
        <label for="form-margin">Margin (px)</label>
        <input type="number" id="form-margin" placeholder="Enter margin in px" value="${parseInt(getComputedStyle(selectedElement).margin)}">
        <label for="text-placeholder">Text Input Placeholder</label>
        <input type="text" id="text-placeholder" placeholder="Enter text input placeholder" value="${selectedElement.querySelector('input[type="text"]').placeholder}">
        <label for="email-placeholder">Email Input Placeholder</label>
        <input type="text" id="email-placeholder" placeholder="Enter email input placeholder" value="${selectedElement.querySelector('input[type="email"]').placeholder}">
        <label for="contact-form-text-placeholder">Contact Form Text Placeholder</label>
        <input type="text" id="contact-form-text-placeholder" placeholder="Enter contact form text placeholder" value="${selectedElement.querySelector('textarea').placeholder}">
      `;
          break;
        case 'carousel':
          controlsDiv.innerHTML = `
    <label for="carousel-width">Width (px)</label>
    <input type="number" id="carousel-width" value="${selectedElement.offsetWidth}">
    <label for="carousel-height">Height (px)</label>
    <input type="number" id="carousel-height" value="${selectedElement.offsetHeight}">
    <label for="carousel-autoplay">Autoplay</label>
    <input type="checkbox" id="carousel-autoplay" ${selectedElement.hasAttribute('data-autoplay') ? 'checked' : ''}>
    <label for="carousel-speed">Transition Speed (ms)</label>
    <input type="number" id="carousel-speed" value="${selectedElement.getAttribute('data-speed') || 500}">
    <label for="carousel-slides">Number of Slides</label>
    <input type="number" id="carousel-slides" value="${selectedElement.getAttribute('data-slides') || 1}">
`;
          break;
        case 'video':
          controlsDiv.innerHTML = `
    <label for="video-src">Video Source</label>
    <input type="text" id="video-src" value="${selectedElement.src}">
    <label for="video-width">Width (px)</label>
    <input type="number" id="video-width" value="${parseInt(selectedElement.width)}">
    <label for="video-height">Height (px)</label>
    <input type="number" id="video-height" value="${parseInt(selectedElement.height)}">
    <label for="video-controls">Show Controls</label>
    <input type="checkbox" id="video-controls" ${selectedElement.controls ? 'checked' : ''}>
    <label for="video-autoplay">Autoplay</label>
    <input type="checkbox" id="video-autoplay" ${selectedElement.autoplay ? 'checked' : ''}>
    <label for="video-loop">Loop</label>
    <input type="checkbox" id="video-loop" ${selectedElement.loop ? 'checked' : ''}>
    <label for="video-volume">Volume</label>
    <input type="range" id="video-volume" min="0" max="1" step="0.1" value="${selectedElement.volume}">
`;
          break;
        case 'contact-form':
          controlsDiv.innerHTML = `
        <label for="contact-form-action">Form Action URL</label>
        <input type="text" id="contact-form-action" value="${selectedElement.action || ''}">
        <label for="contact-form-method">Method</label>
        <select id="contact-form-method">
            <option value="get" ${selectedElement.method === 'get'?'selected' : ''}>GET</option>
            <option value="post" ${selectedElement.method === 'post'?'selected' : ''}>POST</option>
        </select>
        <label for="contact-form-bg">Background Color</label>
        <input type="color" id="contact-form-bg" value="${getComputedStyle(selectedElement).backgroundColor}">
        <label for="contact-form-padding">Padding (px)</label>
        <input type="number" id="contact-form-padding" value="${parseInt(getComputedStyle(selectedElement).padding)}">
        <label for="contact-form-margin">Margin (px)</label>
        <input type="number" id="contact-form-margin" value="${parseInt(getComputedStyle(selectedElement).margin)}">
    `;
          break;
case 'input':
      controlsDiv.innerHTML = `
        <label for="input-type">Input Type</label>
        <select id="input-type">
          <option value="text" ${selectedElement.type === 'text' ? 'selected' : ''}>Text</option>
          <option value="number" ${selectedElement.type === 'number' ? 'selected' : ''}>Number</option>
          <option value="email" ${selectedElement.type === 'email' ? 'selected' : ''}>Email</option>
          <option value="password" ${selectedElement.type === 'password' ? 'selected' : ''}>Password</option>
        </select>
        <label for="input-placeholder">Placeholder</label>
        <input type="text" id="input-placeholder" value="${selectedElement.placeholder}">
        <label for="input-required">Required</label>
        <input type="checkbox" id="input-required" ${selectedElement.required ? 'checked' : ''}>
      `;
      break;
    case 'h2':
      controlsDiv.innerHTML = `
        <label for="heading-text">Heading Text</label>
        <input type="text" id="heading-text" value="${selectedElement.textContent}">
        <label for="heading-size">Heading Size</label>
        <select id="heading-size">
          <option value="h1">H1</option>
          <option value="h2" selected>H2</option>
          <option value="h3">H3</option>
          <option value="h4">H4</option>
        </select>
      `;
      break;
          case 'div':
      if (selectedElement.querySelector('.fa')) {
        const platforms = selectedElement.getAttribute('data-platforms').split(',');
        controlsDiv.innerHTML = `
          <h3>Social Media Platforms</h3>
          <div id="platform-checkboxes">
            ${['facebook', 'twitter', 'instagram', 'linkedin', 'youtube'].map(platform => `
              <label>
                <input type="checkbox" id="${platform}-checkbox" ${platforms.includes(platform) ? 'checked' : ''}>
                ${platform.charAt(0).toUpperCase() + platform.slice(1)}
              </label>
            `).join('')}
          </div>
        `;
      } else if (selectedElement.querySelector('ul')) {
        controlsDiv.innerHTML = `
          <label for="toc-depth">Depth</label>
          <input type="number" id="toc-depth" min="1" max="6" value="${selectedElement.getAttribute('data-depth')}">
          <button id="update-toc">Update TOC</button>
        `;
      }
      break;
    case 'i':
      controlsDiv.innerHTML = `
        <label for="icon-class">Icon Class</label>
        <input type="text" id="icon-class" value="${selectedElement.className}">
        <label for="icon-color">Icon Color</label>
        <input type="color" id="icon-color" value="${getComputedStyle(selectedElement).color}">
        <label for="icon-size">Icon Size</label>
        <input type="range" id="icon-size" min="12" max="72" value="${parseInt(getComputedStyle(selectedElement).fontSize)}">
      `;
      break;
    case 'hr':
      controlsDiv.innerHTML = `
        <label for="divider-color">Color</label>
        <input type="color" id="divider-color" value="${getComputedStyle(selectedElement).borderColor}">
        <label for="divider-style">Style</label>
        <select id="divider-style">
          <option value="solid" ${getComputedStyle(selectedElement).borderStyle === 'solid' ? 'selected' : ''}>Solid</option>
          <option value="dashed" ${getComputedStyle(selectedElement).borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>
          <option value="dotted" ${getComputedStyle(selectedElement).borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>
        </select>
        <label for="divider-thickness">Thickness</label>
        <input type="range" id="divider-thickness" min="1" max="10" value="${parseInt(getComputedStyle(selectedElement).borderWidth)}">
      `;
      break;
    case 'table':
      controlsDiv.innerHTML = `
      <label for="table-rows">Rows</label>
      <input type="number" id="table-rows" min="1" value="${selectedElement.getAttribute('data-rows')}">
      <label for="table-columns">Columns</label>
      <input type="number" id="table-columns" min="1" value="${selectedElement.getAttribute('data-columns')}">
      <button id="update-table">Update Table</button><br>
      <label for="table-border">Border</label>
      <input type="checkbox" id="table-border" ${selectedElement.style.border ? 'checked' : ''}>
      <label for="table-striped">Striped Rows</label>
      <input type="checkbox" id="table-striped" ${selectedElement.classList.contains('striped') ? 'checked' : ''}>
      <button id="edit-table-content">Edit Table Content</button>
    `;
      break;
    case 'ul':
    case 'ol':
      // List controls
      controlsDiv.innerHTML = `
        <label for="list-type">List Type</label>
        <select id="list-type">
          <option value="ul" ${elementType === 'ul' ? 'selected' : ''}>Unordered</option>
          <option value="ol" ${elementType === 'ol' ? 'selected' : ''}>Ordered</option>
        </select>
        <label for="list-style">List Style</label>
        <select id="list-style">
          <option value="disc" ${getComputedStyle(selectedElement).listStyleType === 'disc' ? 'selected' : ''}>Disc</option>
          <option value="circle" ${getComputedStyle(selectedElement).listStyleType === 'circle' ? 'selected' : ''}>Circle</option>
          <option value="square" ${getComputedStyle(selectedElement).listStyleType === 'square' ? 'selected' : ''}>Square</option>
          <option value="decimal" ${getComputedStyle(selectedElement).listStyleType === 'decimal' ? 'selected' : ''}>Decimal</option>
          <option value="lower-alpha" ${getComputedStyle(selectedElement).listStyleType === 'lower-alpha' ? 'selected' : ''}>Lower Alpha</option>
          <option value="upper-alpha" ${getComputedStyle(selectedElement).listStyleType === 'upper-alpha' ? 'selected' : ''}>Upper Alpha</option>
        </select>
        <button id="add-list-item">Add Item</button>
      `;
      break;

      }
      document.querySelectorAll('#custom-controls input, #custom-controls select').forEach(input => {
        input.addEventListener('input', () => {
          updateElementProperty(input.id, input.value);
        });
      });
      
      
      
        document.getElementById('update-table')?.addEventListener('click', updateTable);
  document.getElementById('update-toc')?.addEventListener('click', updateTableOfContents);
  document.getElementById('add-list-item')?.addEventListener('click', addListItem);
    }

    function rgbToHex(rgb) {
      let sep = rgb.indexOf(",") > -1 ? "," : " ";
      rgb = rgb.substr(4).split(")")[0].split(sep);
      let r = (+rgb[0]).toString(16),
        g = (+rgb[1]).toString(16),
        b = (+rgb[2]).toString(16);
      if (r.length == 1)
        r = "0" + r;
      if (g.length == 1)
        g = "0" + g;
      if (b.length == 1)
        b = "0" + b;
      return "#" + r + g + b;
    }

    function updateElementProperty(propertyName, value) {
      switch (propertyName) {
        case 'text-content':
        case 'button-text':
          selectedElement.textContent = value;
          break;
        case 'text-color':
        case 'button-color':
          selectedElement.style.color = value;
          break;
        case 'text-size':
          selectedElement.style.fontSize = `${value}px`;
          break;
        case 'button-bg':
          selectedElement.style.backgroundColor = value;
          break;
        case 'image-src':
          selectedElement.src = value;
          break;
        case 'image-alt':
          selectedElement.alt = value;
          break;
          case 'input-type':
      selectedElement.type = value;
      break;
    case 'input-placeholder':
      selectedElement.placeholder = value;
      break;
    case 'input-required':
      selectedElement.required = value;
      break;
    case 'heading-text':
      selectedElement.textContent = value;
      break;
    case 'heading-size':
      const newHeading = document.createElement(value);
      newHeading.textContent = selectedElement.textContent;
      newHeading.style.cssText = selectedElement.style.cssText;
      selectedElement.parentNode.replaceChild(newHeading, selectedElement);
      selectedElement = newHeading;
      break;
          case 'icon-class':
      selectedElement.className = value;
      break;
    case 'icon-color':
      selectedElement.style.backgroundColor = value;
      break;
    case 'icon-size':
      selectedElement.style.fontSize = `${value}px`;
      break;
    case 'divider-color':
      selectedElement.style.borderColor = value;
      break;
    case 'divider-style':
      selectedElement.style.borderStyle = value;
      break;
    case 'divider-thickness':
      selectedElement.style.borderWidth = `${value}px`;
      break;
    case 'table-border':
      selectedElement.style.border = value ? '1px solid black' : 'none';
      selectedElement.style.borderCollapse = value ? 'collapse' : 'separate';
      break;
    case 'table-striped':
      selectedElement.classList.toggle('striped', value);
      break;
    case 'list-type':
      const newList = document.createElement(value);
      newList.innerHTML = selectedElement.innerHTML;
      selectedElement.parentNode.replaceChild(newList, selectedElement);
      selectedElement = newList;
      break;
    case 'list-style':
      selectedElement.style.listStyleType = value;
      break;
    case 'toc-depth':
      selectedElement.setAttribute('data-depth', value);
      break;
      }
      updateCode();
    }

function updateCode() {
  let htmlCode = '';
  let cssCode = '';
  
  document.querySelectorAll('.draggable-element').forEach(el => {
    const style = getComputedStyle(el);
    cssCode += `
.${el.className.replace(/\s+/g, '.')}.${el.getAttribute('data-type')} {
    ${style.backgroundImage && style.backgroundImage !== 'none' ? `background-image: ${style.backgroundImage};` : `background-color: ${style.backgroundColor};`}
    color: ${style.color};
    font-size: ${style.fontSize};
    margin: ${style.margin};
    padding: ${style.padding};
    border: ${style.border};
    width: ${style.width};
    height: ${style.height};
    z-index: ${style.zIndex};
    position: absolute;
    left: ${el.style.left};
    top: ${el.style.top};
}
    `;
  });

  canvas.childNodes.forEach(el => {
    if (el.nodeType === Node.ELEMENT_NODE) {
      htmlCode += el.outerHTML + '\n';
    }
  });

  codePreview.textContent = `
<style>
    ${cssCode}
</style>
${htmlCode}
    `;
}


    document.querySelectorAll('.draggable-element').forEach(element => {
      element.addEventListener('click', function() {
        if (selectedElement) {
          selectedElement.classList.remove('selected');
        }
        selectedElement = this;
        selectedElement.classList.add('selected');
      });
    });
    
    
document.getElementById('open-popup').addEventListener('click', function() {
  if (selectedElement) {
    document.getElementById('css-popup').style.display = 'block';
    const style = getComputedStyle(selectedElement);
    
    if (style.backgroundImage && style.backgroundImage.includes('gradient')) {
      document.getElementById('bg-type').value = 'gradient';
      document.getElementById('gradient-bg').style.display = 'block';
      document.getElementById('solid-bg').style.display = 'none';

      document.getElementById('bg-gradient').value = style.backgroundImage;
    } else {
      document.getElementById('bg-type').value = 'solid';
      document.getElementById('solid-bg').style.display = 'block';
      document.getElementById('gradient-bg').style.display = 'none';

      document.getElementById('bg-color').value = rgbToHex(style.backgroundColor);
    }

    document.getElementById('color').value = rgbToHex(style.color);
    document.getElementById('font-size').value = style.fontSize;
    document.getElementById('margin').value = style.margin;
    document.getElementById('padding').value = style.padding;
    document.getElementById('border').value = style.border;
    document.getElementById('width').value = style.width;
    document.getElementById('height').value = style.height;
    document.getElementById('z-index').value = style.zIndex;
    document.getElementById('custom-css').value = '';
  } else {
    alert('Please select an element first.');
  }
});



document.getElementById('apply-css').addEventListener('click', function() {
  if (selectedElement) {
    const bgType = document.getElementById('bg-type').value;
    const bgColor = document.getElementById('bg-color').value;
    const bgGradient = document.getElementById('bg-gradient').value;
    const color = document.getElementById('color').value;
    const fontSize = document.getElementById('font-size').value;
    const margin = document.getElementById('margin').value;
    const padding = document.getElementById('padding').value;
    const border = document.getElementById('border').value;
    const width = document.getElementById('width').value;
    const height = document.getElementById('height').value;
    const zIndex = document.getElementById('z-index').value;

    if (bgType === 'solid' && bgColor) {
      selectedElement.style.backgroundColor = bgColor;
      selectedElement.style.backgroundImage = 'none';
    } else if (bgType === 'gradient' && bgGradient) {
      selectedElement.style.backgroundImage = bgGradient;
      selectedElement.style.backgroundColor = 'transparent';
    }

    if (color) selectedElement.style.color = color;
    if (fontSize) selectedElement.style.fontSize = fontSize;
    if (margin) selectedElement.style.margin = margin;
    if (padding) selectedElement.style.padding = padding;
    if (border) selectedElement.style.border = border;
    if (width) selectedElement.style.width = width;
    if (height) selectedElement.style.height = height;
    if (zIndex) selectedElement.style.zIndex = zIndex;

    updateCode();
  }
});


document.getElementById('apply-custom-css').addEventListener('click', function() {
  if (selectedElement) {
    const customCss = document.getElementById('custom-css').value;
    selectedElement.style.cssText += `;${customCss}`;
    updateCode();
  }
});

    document.getElementById('close-popup').addEventListener('click', function() {
      document.getElementById('css-popup').style.display = 'none';
    });
    document.getElementById('download-code').addEventListener('click', () => {
      const htmlContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Generated Website</title>
    </head>
    <body>
      ${codePreview.textContent}
    </body>
    </html>
  `;
      const blob = new Blob([htmlContent], {
        type: 'text/html'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'generated_website.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
    updateCode();
    canvas.addEventListener('dragover', event => {
      event.preventDefault();
    });
canvas.addEventListener('drop', event => {
  event.preventDefault();

  handleStateChange();

  const type = event.dataTransfer.getData('type');
  const newElement = createElement(type);
  const rect = canvas.getBoundingClientRect();
  newElement.style.left = `${snapToGrid(event.clientX - rect.left)}px`; 
  newElement.style.top = `${snapToGrid(event.clientY - rect.top)}px`;
  canvas.appendChild(newElement);
  addResizeHandles(newElement);
  newElement.addEventListener('mousedown', startDrag); 
  makeDraggable(newElement);

  updateCode();

  console.log('Element dropped and state captured');
});

    canvas.addEventListener('mousedown', event => {
      const target = event.target.closest('.draggable');
      if (target) {
        startDrag(event);
      }
    });
    document.querySelectorAll('.draggable-element').forEach(element => {
      element.addEventListener('dragstart', event => {
        event.dataTransfer.setData('type', element.getAttribute('data-type'));
      });
    });

document.addEventListener('keydown', function(event) {
  if ((event.key === 'Delete' || event.key === 'Backspace') && event.shiftKey && selectedElement) { 
    event.preventDefault();
    try {
      canvas.removeChild(selectedElement);
      console.log('Element removed:', selectedElement);
    } catch (error) {
      console.error('Error removing element:', error);
    }
    selectedElement = null; 
    updateControls();
    handleStateChange();
    updateCode();
  } else if ((event.key === 'Delete' || event.key === 'Backspace') && !event.shiftKey) {
    showText('Press Shift+Delete to remove element', 1000);
  }
});


function makeDraggable(element) {
  let isDragging = false;
  let offsetX, offsetY;

  element.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - element.getBoundingClientRect().left;
    offsetY = e.clientY - element.getBoundingClientRect().top;
    handleStateChange(); 
  });

  window.addEventListener('mousemove', (e) => {
    if (isDragging) {
      const rect = canvas.getBoundingClientRect();
      const x = snapToGrid(e.clientX - rect.left - offsetX); 
      const y = snapToGrid(e.clientY - rect.top - offsetY);
      element.style.left = `${x}px`;
      element.style.top = `${y}px`;
    }
  });

  window.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      handleStateChange();
      updateCode();
      console.log('Element dragged and state captured');
    }
  });
}


    function getCSSCode() {
      let cssCode = '';
      document.querySelectorAll('.draggable-element').forEach(el => {
        const style = getComputedStyle(el);
        cssCode += `
        .${el.className.replace(/\s+/g, '.')}.${el.getAttribute('data-type')} {
            background-color: ${style.backgroundColor};
            color: ${style.color};
            font-size: ${style.fontSize};
            margin: ${style.margin};
            padding: ${style.padding};
            border: ${style.border};
            width: ${style.width};
            height: ${style.height};
            position: absolute;
            left: ${el.style.left};
            top: ${el.style.top};
        }
        `;
      });
      return cssCode;
    }

function updateCanvasAndCode(state) {
  canvas.innerHTML = state.htmlCode;
  codePreview.textContent = `<style>${state.cssCode}</style>${state.htmlCode}`;
  
  canvas.querySelectorAll('.draggable').forEach(element => {
    element.addEventListener('mousedown', startDrag);
    makeDraggable(element);
    addResizeHandles(element);
  });
}

    function captureState() {
      const htmlCode = canvas.innerHTML;
      const cssCode = getCSSCode();
      return { htmlCode, cssCode };
    }


    function undo() {
      if (undoStack.length > 0) {
        const state = undoStack.pop();
        redoStack.push(captureState());
        updateCanvasAndCode(state);
      }
    }

    function redo() {
      if (redoStack.length > 0) {
        const state = redoStack.pop();
        undoStack.push(captureState());
        updateCanvasAndCode(state);
      }
    }
    document.getElementById('undo-button').addEventListener('click', undo);
    document.getElementById('redo-button').addEventListener('click', redo);
    canvas.addEventListener('drop', () => {
      handleStateChange();
      updateCode();
    });
    document.getElementById('apply-css').addEventListener('click', () => {
      handleStateChange();
      updateCode();
    });
    document.getElementById('delete-element').addEventListener('click', () => {
      handleStateChange();
      updateCode();
    });

    function makePopupDraggable(popup, header) {
      let isDragging = false;
      let offsetX, offsetY;
      header.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - popup.getBoundingClientRect().left;
        offsetY = e.clientY - popup.getBoundingClientRect().top;
      });
      window.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const x = e.clientX - offsetX;
          const y = e.clientY - offsetY;
          popup.style.left = `${x}px`;
          popup.style.top = `${y}px`;
        }
      });
      window.addEventListener('mouseup', () => {
        isDragging = false;
      });
    }
    const cssPopup = document.getElementById('css-popup');
    const popupHeader = document.getElementById('popup-header');
    makePopupDraggable(cssPopup, popupHeader);

    function showText(text, duration) {
      const element = document.getElementById('disappearingText');
      element.textContent = text;
      element.style.opacity = '1';
      setTimeout(() => {
        element.style.opacity = '0';
        element.textContent = '';
      }, duration);
    }

function updateTable() {
  const rows = parseInt(document.getElementById('table-rows').value);
  const columns = parseInt(document.getElementById('table-columns').value);
  let tableHTML = '';
  for (let i = 0; i < rows; i++) {
    tableHTML += '<tr>';
    for (let j = 0; j < columns; j++) {
      tableHTML += i === 0 ? '<th>Header</th>' : '<td>Cell</td>';
    }
    tableHTML += '</tr>';
  }
  selectedElement.innerHTML = tableHTML;
  selectedElement.setAttribute('data-rows', rows);
  selectedElement.setAttribute('data-columns', columns);
  addResizeHandles(selectedElement);
  updateCode();
  handleStateChange();
}

function editTableContent() {
  const rows = parseInt(selectedElement.getAttribute('data-rows'));
  const columns = parseInt(selectedElement.getAttribute('data-columns'));
  let editHTML = '<table>';
  
  // Add column headers with add/remove buttons
  editHTML += '<tr><th></th>';
  for (let j = 0; j < columns; j++) {
    editHTML += `<th>
      Column ${j + 1}
      <button class="remove-column" data-col="${j}">-</button>
    </th>`;
  }
  editHTML += `<th><button id="add-column">+</button></th></tr>`;

  // Add rows with editable cells and add/remove buttons
  for (let i = 0; i < rows; i++) {
    editHTML += `<tr>
      <td>
        <button class="remove-row" data-row="${i}">-</button>
      </td>`;
    for (let j = 0; j < columns; j++) {
      const cellContent = selectedElement.rows[i].cells[j].textContent;
      editHTML += `<td><input type="text" value="${cellContent}" data-row="${i}" data-col="${j}"></td>`;
    }
    editHTML += '<td></td></tr>';
  }

  // Add row at the bottom
  editHTML += `<tr><td><button id="add-row">+</button></td></tr>`;

  editHTML += '</table>';
  editHTML += '<button id="save-table-content">Save</button>';

  const editPopup = document.createElement('div');
  editPopup.innerHTML = editHTML;
  editPopup.style.position = 'fixed';
  editPopup.style.top = '50%';
  editPopup.style.left = '50%';
  editPopup.style.transform = 'translate(-50%, -50%)';
  editPopup.style.backgroundColor = 'white';
  editPopup.style.padding = '20px';
  editPopup.style.border = '1px solid black';
  editPopup.style.zIndex = '1000';
  editPopup.style.maxHeight = '80vh';
  editPopup.style.overflowY = 'auto';

  document.body.appendChild(editPopup);

  // Event listener for adding a row
  document.getElementById('add-row').addEventListener('click', () => {
    const newRow = document.createElement('tr');
    newRow.innerHTML = `<td><button class="remove-row" data-row="${rows}">-</button></td>`;
    for (let j = 0; j < columns; j++) {
      newRow.innerHTML += `<td><input type="text" value="" data-row="${rows}" data-col="${j}"></td>`;
    }
    newRow.innerHTML += '<td></td>';
    editPopup.querySelector('table').insertBefore(newRow, editPopup.querySelector('#add-row').parentNode.parentNode);
    rows++;
  });

  // Event listener for adding a column
  document.getElementById('add-column').addEventListener('click', () => {
    const headerRow = editPopup.querySelector('table tr');
    const newHeader = document.createElement('th');
    newHeader.innerHTML = `Column ${columns + 1} <button class="remove-column" data-col="${columns}">-</button>`;
    headerRow.insertBefore(newHeader, headerRow.lastElementChild);

    const dataRows = editPopup.querySelectorAll('table tr:not(:first-child):not(:last-child)');
    dataRows.forEach((row, i) => {
      const newCell = document.createElement('td');
      newCell.innerHTML = `<input type="text" value="" data-row="${i}" data-col="${columns}">`;
      row.insertBefore(newCell, row.lastElementChild);
    });
    columns++;
  });

  // Event delegation for removing rows and columns
  editPopup.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-row')) {
      const rowIndex = parseInt(e.target.getAttribute('data-row'));
      editPopup.querySelector(`tr:nth-child(${rowIndex + 2})`).remove();
      rows--;
    } else if (e.target.classList.contains('remove-column')) {
      const colIndex = parseInt(e.target.getAttribute('data-col'));
      editPopup.querySelectorAll('tr').forEach(row => {
        row.querySelector(`td:nth-child(${colIndex + 2}), th:nth-child(${colIndex + 2})`).remove();
      });
      columns--;
    }
  });

  // Save button event listener
  document.getElementById('save-table-content').addEventListener('click', () => {
    // Create a new table with the updated content
    const newTable = document.createElement('table');
    newTable.innerHTML = '<tbody></tbody>';
    const tbody = newTable.querySelector('tbody');

    const inputs = editPopup.querySelectorAll('input');
    let currentRow;
    inputs.forEach(input => {
      const row = parseInt(input.getAttribute('data-row'));
      const col = parseInt(input.getAttribute('data-col'));
      
      if (!currentRow || currentRow.rowIndex !== row) {
        currentRow = tbody.insertRow();
      }
      
      const cell = currentRow.insertCell();
      cell.textContent = input.value;
    });

    // Replace the old table with the new one
    selectedElement.innerHTML = newTable.innerHTML;
    selectedElement.setAttribute('data-rows', rows);
    selectedElement.setAttribute('data-columns', columns);

    document.body.removeChild(editPopup);
    updateCode();
    handleStateChange();
  });
}

// Make sure to keep the event listener for the edit button
document.getElementById('edit-table-content').addEventListener('click', editTableContent);


function addListItem() {
  const newItem = document.createElement('li');
  newItem.textContent = 'New Item';
  selectedElement.appendChild(newItem);
  updateCode();
}

document.getElementById('platform-checkboxes')?.addEventListener('change', (e) => {
  if (e.target.type === 'checkbox') {
    const platforms = Array.from(document.querySelectorAll('#platform-checkboxes input:checked'))
      .map(checkbox => checkbox.id.replace('-checkbox', ''));
    selectedElement.innerHTML = platforms.map(platform => 
      `<a href="#" class="fa fa-${platform}"></a>`
    ).join(' ');
    selectedElement.setAttribute('data-platforms', platforms.join(','));
    updateCode();
  }
});

document.getElementById('bg-type').addEventListener('change', function() {
  const bgType = this.value;
  if (bgType === 'solid') {
    document.getElementById('solid-bg').style.display = 'block';
    document.getElementById('gradient-bg').style.display = 'none';
  } else if (bgType === 'gradient') {
    document.getElementById('solid-bg').style.display = 'none';
    document.getElementById('gradient-bg').style.display = 'block';
  }
});


function rgbToHex(rgb) {
  const result = /^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(rgb);
  return result ? 
    "#" + 
    ("0" + parseInt(result[1],10).toString(16)).slice(-2) + 
    ("0" + parseInt(result[2],10).toString(16)).slice(-2) + 
    ("0" + parseInt(result[3],10).toString(16)).slice(-2) 
    : '#ffffff';
}
  </script>
</body>
